(()=>{"use strict";const e=[{id:"framer-minimal",name:"Framer Minimal",styles:{backgroundColor:"#FFFFFF",textColor:"#000000",buttonColor:"#0099FF",displayColor:"#F5F5F5",displayTextColor:"#000000",accentColor:"#0099FF",borderRadius:"12px"}},{id:"framer-dark",name:"Framer Dark",styles:{backgroundColor:"#1E1E1E",textColor:"#FFFFFF",buttonColor:"#0099FF",displayColor:"#2D2D2D",displayTextColor:"#FFFFFF",accentColor:"#0099FF",borderRadius:"12px"}},{id:"te-op1",name:"TE OP-1",styles:{backgroundColor:"#FFCC00",textColor:"#000000",buttonColor:"#000000",displayColor:"#111111",displayTextColor:"#FFFFFF",accentColor:"#FF0000",borderRadius:"4px"}},{id:"te-op1-dark",name:"TE OP-1 Dark",styles:{backgroundColor:"#222222",textColor:"#FFFFFF",buttonColor:"#FFCC00",displayColor:"#000000",displayTextColor:"#FFCC00",accentColor:"#FFCC00",borderRadius:"4px"}},{id:"neo-mint",name:"Neo Mint",styles:{backgroundColor:"#BDEED0",textColor:"#2A3B47",buttonColor:"#0CC0DF",displayColor:"#FFFFFF",displayTextColor:"#2A3B47",accentColor:"#FF6B95",borderRadius:"16px"}},{id:"vapor-wave",name:"Vapor Wave",styles:{backgroundColor:"#131377",textColor:"#FFFFFF",buttonColor:"#FF00FF",displayColor:"#000000",displayTextColor:"#00FFFF",accentColor:"#FF00FF",borderRadius:"0px"}},{id:"ipod-classic",name:"iPod Classic",styles:{backgroundColor:"#ECECEC",textColor:"#000000",buttonColor:"#6A6A6A",displayColor:"#D6DCE4",displayTextColor:"#000000",accentColor:"#007AFF",borderRadius:"8px"}},{id:"minimal-player",name:"미니멀 플레이어 (앨범아트 없음)",styles:{backgroundColor:"#F8F8F8",textColor:"#333333",buttonColor:"#555555",displayColor:"#FFFFFF",displayTextColor:"#333333",accentColor:"#555555",borderRadius:"4px"}}];class o{constructor(){console.log("ThemeManager 초기화 시작");try{if(!e||0===e.length)throw console.error("테마 데이터가 비어 있습니다"),new Error("테마 데이터가 비어 있습니다");const o=e.find((e=>"te-op1"===e.id));o?(this.currentTheme=o,console.log(`기본 테마 설정됨: ${o.name}`)):(this.currentTheme=e[0],console.log(`기본 테마를 찾을 수 없어 첫 번째 테마로 설정: ${e[0].name}`))}catch(e){console.error("ThemeManager 초기화 중 오류:",e),this.currentTheme={id:"default",name:"Default Theme",styles:{backgroundColor:"#FFFFFF",textColor:"#000000",buttonColor:"#0099FF",displayColor:"#F5F5F5",displayTextColor:"#000000",accentColor:"#0099FF",borderRadius:"4px"}}}}static getInstance(){return o.instance||(o.instance=new o),o.instance}getCurrentTheme(){return this.currentTheme}setCurrentTheme(e){e?(console.log(`테마 변경: ${e.name} (${e.id})`),this.currentTheme=e):console.error("유효하지 않은 테마가 설정되었습니다")}getThemeById(o){if(o)try{const t=e.find((e=>e.id===o));return t||console.warn(`테마를 찾을 수 없음: ${o}`),t}catch(e){return void console.error(`테마 검색 중 오류 (ID: ${o}):`,e)}else console.error("유효하지 않은 테마 ID입니다")}getAllThemes(){return[...e]}generateCSSVariables(e){try{if(!e||!e.styles)throw console.error("유효하지 않은 테마 데이터"),new Error("유효하지 않은 테마 데이터");const{styles:o}=e;return console.log("CSS 변수 생성:",e.id),`\n        :root {\n          --theme-background: ${o.backgroundColor};\n          --theme-text: ${o.textColor};\n          --theme-button: ${o.buttonColor};\n          --theme-display: ${o.displayColor};\n          --theme-display-text: ${o.displayTextColor};\n          --theme-accent: ${o.accentColor};\n          --theme-radius: ${o.borderRadius};\n        }\n      `}catch(e){return console.error("CSS 변수 생성 중 오류:",e),"\n        :root {\n          --theme-background: #FFFFFF;\n          --theme-text: #000000;\n          --theme-button: #0099FF;\n          --theme-display: #F5F5F5;\n          --theme-display-text: #000000;\n          --theme-accent: #0099FF;\n          --theme-radius: 4px;\n        }\n      "}}applyThemeToFigmaNode(e,o){try{if(!e)return void console.error("유효하지 않은 Figma 노드");if(!o||!o.styles)return void console.error("유효하지 않은 테마 데이터");const{styles:t}=o;e.fills=[{type:"SOLID",color:this.hexToRGB(t.backgroundColor)}],e.strokes=[{type:"SOLID",color:this.hexToRGB(t.textColor)}],e.cornerRadius=parseInt(t.borderRadius)||4,e.setPluginData("themeId",o.id),console.log(`테마 ${o.id}가 Figma 노드에 적용됨`)}catch(e){console.error("Figma 노드에 테마 적용 중 오류:",e)}}hexToRGB(e){try{if(!e||"string"!=typeof e)throw new Error("유효하지 않은 HEX 색상 값");if(e=e.replace("#",""),!/^[0-9A-Fa-f]{6}$/.test(e))throw new Error("유효하지 않은 HEX 형식");const o=parseInt(e.substring(0,2),16)/255;return{r:o,g:parseInt(e.substring(2,4),16)/255,b:parseInt(e.substring(4,6),16)/255}}catch(e){return console.error("HEX to RGB 변환 중 오류:",e),{r:0,g:0,b:0}}}}var t=function(e,o,t,r){return new(t||(t=Promise))((function(l,n){function a(e){try{i(r.next(e))}catch(e){n(e)}}function s(e){try{i(r.throw(e))}catch(e){n(e)}}function i(e){var o;e.done?l(e.value):(o=e.value,o instanceof t?o:new t((function(e){e(o)}))).then(a,s)}i((r=r.apply(e,o||[])).next())}))};figma.showUI(__html__,{width:320,height:460,themeColors:!0});const r=o.getInstance();figma.ui.onmessage=e=>t(void 0,void 0,void 0,(function*(){switch(console.log("메시지 수신:",e.type),e.type){case"insert-player":try{yield function(e,o){return t(this,void 0,void 0,(function*(){const l=yield function(){return t(this,void 0,void 0,(function*(){const e=[{family:"Inter",style:"Bold"},{family:"Roboto",style:"Bold"},{family:"SF Pro",style:"Bold"},{family:"Arial",style:"Bold"}],o=[{family:"Inter",style:"Regular"},{family:"Roboto",style:"Regular"},{family:"SF Pro",style:"Regular"},{family:"Arial",style:"Regular"}];let t=null,r=null;for(const o of e)try{yield figma.loadFontAsync(o),t=o,console.log(`사용할 볼드 폰트: ${o.family} ${o.style}`);break}catch(e){console.log(`폰트 사용 불가: ${o.family} ${o.style}`)}for(const e of o)try{yield figma.loadFontAsync(e),r=e,console.log(`사용할 일반 폰트: ${e.family} ${e.style}`);break}catch(o){console.log(`폰트 사용 불가: ${e.family} ${e.style}`)}return{bold:t||{family:"Arial",style:"Bold"},regular:r||{family:"Arial",style:"Regular"}}}))}(),n=figma.createFrame();n.name=`SC MICRO - ${e.title}`,n.resize(160,40),r.applyThemeToFigmaNode(n,o),n.setPluginData("trackUrl",e.url),n.setPluginData("trackTitle",e.title),n.setPluginData("trackArtist",e.artist);const a=figma.createFrame();a.name="Content",a.resize(150,30),a.x=5,a.y=5,a.fills=[{type:"SOLID",color:r.hexToRGB(o.styles.displayColor)}],a.cornerRadius=4,n.appendChild(a);const s=figma.createFrame();s.name="Album Art",s.resize(20,20),s.x=5,s.y=5,s.fills=[{type:"SOLID",color:r.hexToRGB(o.styles.accentColor)}],s.cornerRadius=2,a.appendChild(s);const i=figma.createText();i.fontName=l.bold,i.characters=e.title,i.fontSize=9,i.fills=[{type:"SOLID",color:r.hexToRGB(o.styles.displayTextColor)}],a.appendChild(i),i.x=30,i.y=5;const c=figma.createText();c.fontName=l.regular,c.characters=e.artist,c.fontSize=7,c.fills=[{type:"SOLID",color:r.hexToRGB(o.styles.displayTextColor),opacity:.8}],a.appendChild(c),c.x=30,c.y=18;const d=figma.createEllipse();d.name="Status",d.resize(4,4),d.x=140,d.y=13,d.fills=[{type:"SOLID",color:{r:0,g:1,b:.5}}],a.appendChild(d);const F=figma.viewport.center;n.x=F.x-n.width/2,n.y=F.y-n.height/2,figma.currentPage.selection=[n],figma.viewport.scrollAndZoomIntoView([n]),figma.notify(`${e.title} 마이크로 플레이어가 삽입되었습니다`)}))}(e.track,e.theme)}catch(e){console.error("플레이어 삽입 오류:",e),figma.notify(`오류가 발생했습니다: ${e.message}`,{error:!0})}break;case"change-theme":try{r.setCurrentTheme(e.theme),o=e.theme,figma.currentPage.findAll((e=>"FRAME"===e.type&&""!==e.getPluginData("trackUrl"))).forEach((e=>{if("FRAME"===e.type){r.applyThemeToFigmaNode(e,o);const t=e.findOne((e=>"Content"===e.name&&"FRAME"===e.type));if(t&&"FRAME"===t.type){t.fills=[{type:"SOLID",color:r.hexToRGB(o.styles.displayColor)}],t.findAll((e=>"TEXT"===e.type)).forEach((e=>{"TEXT"===e.type&&(e.fills=[{type:"SOLID",color:r.hexToRGB(o.styles.displayTextColor)}])}));const e=t.findOne((e=>"Album Art"===e.name&&"FRAME"===e.type));e&&"FRAME"===e.type&&(e.fills=[{type:"SOLID",color:r.hexToRGB(o.styles.accentColor)}])}}})),figma.notify(`테마가 변경되었습니다: ${e.theme.name}`)}catch(e){console.error("테마 변경 오류:",e),figma.notify("테마 변경 중 오류가 발생했습니다",{error:!0})}break;case"close":figma.closePlugin()}var o}))})();